<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mdbase | WYSIWYG Editor</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- Turndown Service for HTML -> Markdown -->
    <script src="https://unpkg.com/turndown/dist/turndown.js"></script>
    <script src="https://unpkg.com/turndown-plugin-gfm/dist/turndown-plugin-gfm.js"></script>

    <!-- FileSaver for Exports -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <!-- Marked for Markdown -> HTML -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- KaTeX for Math -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>

    <!-- Mermaid for Diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.2.4/dist/mermaid.min.js"></script>

    <!-- Prism.js for Syntax Highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markdown.min.js"></script>

    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <link rel="stylesheet" href="style.css?v=3">
    <style>
        /* Tooltips */
        [data-tooltip] {
            position: relative;
        }

        [data-tooltip]::before,
        [data-tooltip]::after {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s, transform 0.2s;
            z-index: 1000;
        }

        [data-tooltip]::after {
            content: attr(data-tooltip);
            background: #111827;
            color: white;
            font-size: 0.75rem;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            white-space: nowrap;
            bottom: 100%;
            margin-bottom: 10px;
            font-weight: 500;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        [data-tooltip]::before {
            content: '';
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid #111827;
            bottom: 100%;
            margin-bottom: 4px;
        }

        [data-tooltip]:hover::before,
        [data-tooltip]:hover::after {
            opacity: 1;
            transform: translateX(-50%) translateY(-2px);
        }
    </style>
</head>
<body>

    <div class="app-container">
        <!-- Bento Dashboard Overlay -->
        <div id="sidebar" class="dashboard-overlay">
            <div class="dashboard-content">
                <div class="dashboard-header">
                    <div class="brand">
                        <img src="logotype_small.png" alt="mdbase Logo" height="48">
                        <div class="brand-name">
                            <span class="brand-text">md</span><span>base</span>
                        </div>
                    </div>
                    <button id="close-dashboard" class="btn secondary icon-only"><i class="ph ph-x"></i></button>
                </div>

                <div class="bento-grid">
                    <!-- Documents Card -->
                    <div class="bento-card docs-card">
                        <div class="card-header">
                            <h3><i class="ph ph-files"></i> My Documents</h3>
                            <button id="new-doc-btn-dashboard">
                                <i class="ph ph-plus"></i>
                                <span>New</span>
                            </button>
                        </div>
                        <div id="doc-list" class="doc-list">
                            <!-- Documents will be rendered here -->
                        </div>
                        <!-- Storage Disclaimer -->
                <div class="dashboard-disclaimer">
                    <i class="ph ph-warning-circle"></i>
                    <p>Documents are stored locally in your browser. Use <strong>Export</strong> to back up your work.</p>
                </div>
                    </div>

                    <!-- Quick Navigation Card -->
                    <div class="bento-card nav-card">
                        <h3><i class="ph ph-compass"></i> Navigation</h3>
                        <div class="nav-stack">
                            <button id="shortcuts-btn" class="nav-item">
                                <i class="ph ph-keyboard"></i>
                                <span>Shortcuts</span>
                            </button>
                            <button id="outline-btn" class="nav-item">
                                <i class="ph ph-list-numbers"></i>
                                <span>Outline</span>
                            </button>
                        </div>
                    </div>

                    <!-- Stats Card -->
                    <div class="bento-card stats-card">
                        <h3><i class="ph ph-chart-bar"></i> Overview</h3>
                        <div class="stats-overview">
                            <div class="stat-item">
                                <span class="stat-value" id="total-docs-count">0</span>
                                <span class="stat-label">Document(s)</span>
                            </div>
                        </div>
                    </div>

                    <!-- User Card -->
                    <div class="bento-card user-card">
                        <div class="user-profile">
                            <div class="avatar">G</div>
                            <div class="user-info">
                                <span class="name">Guest</span>
                                <span class="status">Online</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Main Content Area -->
        <main class="editor-area">
            <!-- Floating Toolbar -->
            <div class="toolbar-container">
                <div class="toolbar">
                    <!-- Left: Menu -->
                    <div class="toolbar-segment">
                        <button id="menu-toggle" class="tool-btn" data-tooltip="Menu">
                            <i class="ph ph-list"></i>
                        </button>
                    </div>

                    <!-- Center: Formatting Tools -->
                    <div class="toolbar-segment center">
                        <div class="toolbar-group">
                            <button class="tool-btn" data-command="formatBlock" data-value="h1" data-tooltip="Heading 1">
                                <span style="font-weight: 700; font-size: 1.1em;">H1</span>
                            </button>
                            <button class="tool-btn" data-command="formatBlock" data-value="h2" data-tooltip="Heading 2">
                                <span style="font-weight: 600;">H2</span>
                            </button>
                        </div>
                        <div class="divider"></div>
                        <div class="toolbar-group">
                            <button class="tool-btn" data-command="bold" data-tooltip="Bold">
                                <i class="ph ph-text-b"></i>
                            </button>
                            <button class="tool-btn" data-command="italic" data-tooltip="Italic">
                                <i class="ph ph-text-italic"></i>
                            </button>
                            <button class="tool-btn" data-command="strikeThrough" data-tooltip="Strikethrough">
                                <i class="ph ph-text-strikethrough"></i>
                            </button>
                            <button class="tool-btn" data-command="underline" data-tooltip="Underline">
                                <i class="ph ph-text-underline"></i>
                            </button>
                            <button class="tool-btn" id="btn-subscript" data-tooltip="Subscript">
                                <i class="ph ph-text-subscript"></i>
                            </button>
                            <button class="tool-btn" id="btn-superscript" data-tooltip="Superscript">
                                <i class="ph ph-text-superscript"></i>
                            </button>
                        </div>
                        <div class="divider"></div>
                        <div class="toolbar-group">
                            <button class="tool-btn" data-command="formatBlock" data-value="pre" data-tooltip="Code Block">
                                <i class="ph ph-code-block"></i>
                            </button>
                            <button class="tool-btn" id="inline-code-btn" data-tooltip="Inline Code">
                                <i class="ph ph-code"></i>
                            </button>
                        </div>
                        <div class="divider"></div>
                        <div class="toolbar-group">
                            <button class="tool-btn" data-command="insertUnorderedList" data-tooltip="Bulleted List">
                                <i class="ph ph-list-bullets"></i>
                            </button>
                            <button class="tool-btn" data-command="insertOrderedList" data-tooltip="Numbered List">
                                <i class="ph ph-list-numbers"></i>
                            </button>

                            <div class="tool-btn-dropdown" id="quote-dropdown">
                                <button class="tool-btn" data-tooltip="Quote / Alerts">
                                    <i class="ph ph-quotes"></i>
                                    <i class="ph ph-caret-down" style="font-size: 0.6em; margin-left: 2px;"></i>
                                </button>
                                <div class="dropdown-menu">
                                    <button class="dropdown-item" data-insert="blockquote">
                                        <i class="ph ph-quotes"></i> Quote
                                    </button>
                                    <div class="dropdown-divider"></div>
                                    <button class="dropdown-item" data-insert="alert-note">
                                        <i class="ph ph-info"></i> Note
                                    </button>
                                    <button class="dropdown-item" data-insert="alert-tip">
                                        <i class="ph ph-lightbulb"></i> Tip
                                    </button>
                                    <button class="dropdown-item" data-insert="alert-important">
                                        <i class="ph ph-star"></i> Important
                                    </button>
                                    <button class="dropdown-item" data-insert="alert-warning">
                                        <i class="ph ph-warning"></i> Warning
                                    </button>
                                    <button class="dropdown-item" data-insert="alert-caution">
                                        <i class="ph ph-warning-octagon"></i> Caution
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="divider"></div>
                        <div class="toolbar-group">
                            <button class="tool-btn" id="btn-insert-table" data-tooltip="Insert Table">
                                <i class="ph ph-table"></i>
                            </button>
                            <button class="tool-btn" id="btn-insert-tasklist" data-tooltip="Checklist">
                                <i class="ph ph-check-square-offset"></i>
                            </button>
                            <button class="tool-btn" id="btn-insert-link" data-tooltip="Insert Link">
                                <i class="ph ph-link"></i>
                            </button>
                            <button class="tool-btn" id="btn-insert-image" data-tooltip="Insert Image">
                                <i class="ph ph-image"></i>
                            </button>
                            <button class="tool-btn" id="btn-insert-hr" data-tooltip="Horizontal Rule">
                                <i class="ph ph-minus"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Right: Actions -->
                    <div class="toolbar-segment">
                        <div class="toolbar-group">
                            <button id="mobile-source-btn" class="mobile-source-btn" aria-label="View Source Code">
                                <i class="ph ph-code"></i>
                                <span>MD</span>
                            </button>
                            <button id="toggle-split-view" class="tool-btn" data-tooltip="Split View">
                                <i class="ph ph-columns"></i>
                            </button>
                            <div class="tool-btn-dropdown" id="export-dropdown">
                                <button class="tool-btn" data-tooltip="Export">
                                    <i class="ph ph-download"></i>
                                    <i class="ph ph-caret-down" style="font-size: 0.6em; margin-left: 2px;"></i>
                                </button>
                                <div class="dropdown-menu">
                                    <button class="dropdown-item" id="export-md">
                                        <i class="ph ph-file-md"></i> Markdown (.md)
                                    </button>
                                    <button class="dropdown-item" id="export-html">
                                        <i class="ph ph-file-html"></i> HTML (.html)
                                    </button>
                                    <div class="dropdown-divider"></div>
                                    <button class="dropdown-item" id="export-pdf">
                                        <i class="ph ph-printer"></i> PDF (via Print)
                                    </button>
                                </div>
                            </div>
                            <button id="toggle-dark-mode" class="tool-btn" data-tooltip="Toggle Dark Mode">
                                <i class="ph ph-moon"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Workspace Area (Editor + Preview) -->
            <div class="workspace" id="workspace">
                <!-- Outline / Navigator -->
                <div id="outline-sidebar" class="outline-sidebar hidden">
                    <div class="outline-header">
                        <span>Outline</span>
                        <button id="close-outline" class="btn secondary icon-only small"><i class="ph ph-x"></i></button>
                    </div>
                    <div id="outline-content" class="outline-list">
                        <!-- TOC goes here -->
                    </div>
                </div>

                <!-- WYSIWYG Editor Canvas -->
                <div class="editor-wrapper" id="wysiwyg-wrapper">
                    <div id="editor" class="editor-content" contenteditable="true" spellcheck="false"></div>
                </div>

                <!-- Markdown Source View (for Split View) -->
                <div class="preview-wrapper hidden" id="source-wrapper">
                    <div class="source-header">
                        <span>Markdown</span>
                        <button id="copy-source" class="btn secondary icon-only small" data-tooltip="Copy">
                            <i class="ph ph-copy"></i>
                        </button>
                    </div>
                    <textarea id="source-textarea" spellcheck="false" placeholder="Write Markdown here..."></textarea>
                </div>
            </div>

            <!-- Stats Bar -->
            <footer class="stats-bar">
                <span id="word-count">0 words</span>
                <span class="separator">•</span>
                <span id="read-time">~ 1 min read</span>
            </footer>
        </main>


        <!-- Shortcuts Modal -->
        <div id="shortcuts-modal" class="modal hidden">
            <div class="modal-content shortcuts-content">
                <div class="modal-header">
                    <h2>Shortcuts</h2>
                    <button id="close-shortcuts-modal" class="close-btn"><i class="ph ph-x"></i></button>
                </div>
                <div class="modal-body">
                    <div class="shortcuts-grid">
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Split View</span>
                            <div class="keys"><kbd class="mod-key">⌘</kbd> + <kbd>J</kbd></div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Outline</span>
                            <div class="keys"><kbd class="mod-key">⌘</kbd> + <kbd>O</kbd></div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Find & Replace</span>
                            <div class="keys"><kbd class="mod-key">⌘</kbd> + <kbd>F</kbd></div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Bold</span>
                            <div class="keys"><kbd class="mod-key">⌘</kbd> + <kbd>B</kbd></div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Italic</span>
                            <div class="keys"><kbd class="mod-key">⌘</kbd> + <kbd>I</kbd></div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Heading 1</span>
                            <div class="keys"><kbd class="mod-key">⌘</kbd> + <kbd>Alt</kbd> + <kbd>1</kbd></div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Heading 2</span>
                            <div class="keys"><kbd class="mod-key">⌘</kbd> + <kbd>Alt</kbd> + <kbd>2</kbd></div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Bulleted List</span>
                            <div class="keys"><kbd class="mod-key">⌘</kbd> + <kbd>Shift</kbd> + <kbd>8</kbd></div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Numbered List</span>
                            <div class="keys"><kbd class="mod-key">⌘</kbd> + <kbd>Shift</kbd> + <kbd>7</kbd></div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Show Shortcuts</span>
                            <div class="keys"><kbd class="mod-key">⌘</kbd> + <kbd>H</kbd></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-backdrop"></div>
        </div>

        <!-- Language Selection Modal -->
        <div id="language-modal" class="modal hidden">
            <div class="modal-content shortcuts-content" style="max-width: 400px;">
                <div class="modal-header">
                    <h2>Code Language</h2>
                    <button id="close-language-modal" class="btn secondary icon-only small"><i class="ph ph-x"></i></button>
                </div>
                <div class="modal-body" style="background: var(--bg-editor); color: var(--text-primary); padding: 1.5rem; display: block;">
                    <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.75rem;">Enter programming language (e.g., javascript, py, css):</p>
                    <div class="command-input-container" style="border: 1px solid var(--border-color); border-radius: 0.5rem; background: var(--bg-app);">
                        <i class="ph ph-code" style="color: var(--text-secondary);"></i>
                        <input type="text" id="language-input" placeholder="javascript" style="background: transparent; border: none; outline: none; padding: 0.5rem; width: 100%; color: var(--text-primary); font-family: var(--font-mono);">
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="save-language" class="btn primary">Save</button>
                    <button id="cancel-language" class="btn secondary">Cancel</button>
                </div>
            </div>
            <div class="modal-backdrop"></div>
        </div>

        <!-- Confirm Modal -->
        <div id="confirm-modal" class="modal hidden">
            <div class="modal-content shortcuts-content" style="max-width: 400px;">
                <div class="modal-header">
                    <h2 id="confirm-modal-title">Confirm</h2>
                    <button id="close-confirm-modal" class="btn secondary icon-only small"><i class="ph ph-x"></i></button>
                </div>
                <div class="modal-body" style="background: var(--bg-editor); color: var(--text-primary); padding: 1.5rem; display: block;">
                    <p id="confirm-modal-message" style="font-size: 0.95rem;"></p>
                </div>
                <div class="modal-footer">
                    <button id="confirm-modal-yes" class="btn primary">Delete</button>
                    <button id="confirm-modal-no" class="btn secondary">Cancel</button>
                </div>
            </div>
            <div class="modal-backdrop"></div>
        </div>

        <!-- Image Insert Modal -->
        <div id="image-modal" class="modal hidden">
            <div class="modal-content shortcuts-content" style="max-width: 450px;">
                <div class="modal-header">
                    <h2><i class="ph ph-image" style="margin-right: 0.5rem;"></i>Insert Image</h2>
                    <button id="close-image-modal" class="btn secondary icon-only small"><i class="ph ph-x"></i></button>
                </div>
                <div class="modal-body" style="background: var(--bg-editor); color: var(--text-primary); padding: 1.5rem; display: block;">
                    <div style="margin-bottom: 1rem;">
                        <label style="font-size: 0.85rem; color: var(--text-secondary); display: block; margin-bottom: 0.5rem;">Image URL</label>
                        <div class="command-input-container" style="border: 1px solid var(--border-color); border-radius: 0.5rem; background: var(--bg-app);">
                            <i class="ph ph-link" style="color: var(--text-secondary);"></i>
                            <input type="text" id="image-url-input" placeholder="https://example.com/image.png" style="background: transparent; border: none; outline: none; padding: 0.5rem; width: 100%; color: var(--text-primary);">
                        </div>
                    </div>
                    <div>
                        <label style="font-size: 0.85rem; color: var(--text-secondary); display: block; margin-bottom: 0.5rem;">Alt Text (description)</label>
                        <div class="command-input-container" style="border: 1px solid var(--border-color); border-radius: 0.5rem; background: var(--bg-app);">
                            <i class="ph ph-text-aa" style="color: var(--text-secondary);"></i>
                            <input type="text" id="image-alt-input" placeholder="Image description" style="background: transparent; border: none; outline: none; padding: 0.5rem; width: 100%; color: var(--text-primary);">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="insert-image-confirm" class="btn primary">Insert</button>
                    <button id="cancel-image-modal" class="btn secondary">Cancel</button>
                </div>
            </div>
            <div class="modal-backdrop"></div>
        </div>

        <!-- Link Insert Modal -->
        <div id="link-modal" class="modal hidden">
            <div class="modal-content shortcuts-content" style="max-width: 450px;">
                <div class="modal-header">
                    <h2><i class="ph ph-link" style="margin-right: 0.5rem;"></i>Insert Link</h2>
                    <button id="close-link-modal" class="btn secondary icon-only small"><i class="ph ph-x"></i></button>
                </div>
                <div class="modal-body" style="background: var(--bg-editor); color: var(--text-primary); padding: 1.5rem; display: block;">
                    <div style="margin-bottom: 1rem;">
                        <label style="font-size: 0.85rem; color: var(--text-secondary); display: block; margin-bottom: 0.5rem;">Link URL</label>
                        <div class="command-input-container" style="border: 1px solid var(--border-color); border-radius: 0.5rem; background: var(--bg-app);">
                            <i class="ph ph-link" style="color: var(--text-secondary);"></i>
                            <input type="text" id="link-url-input" placeholder="https://example.com" style="background: transparent; border: none; outline: none; padding: 0.5rem; width: 100%; color: var(--text-primary);">
                        </div>
                    </div>
                    <div>
                        <label style="font-size: 0.85rem; color: var(--text-secondary); display: block; margin-bottom: 0.5rem;">Link Text</label>
                        <div class="command-input-container" style="border: 1px solid var(--border-color); border-radius: 0.5rem; background: var(--bg-app);">
                            <i class="ph ph-text-aa" style="color: var(--text-secondary);"></i>
                            <input type="text" id="link-text-input" placeholder="Display text" style="background: transparent; border: none; outline: none; padding: 0.5rem; width: 100%; color: var(--text-primary);">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="insert-link-confirm" class="btn primary">Insert</button>
                    <button id="cancel-link-modal" class="btn secondary">Cancel</button>
                </div>
            </div>
            <div class="modal-backdrop"></div>
        </div>

    </div>

        <!-- Command Palette -->
        <div id="command-palette" class="modal hidden">
            <div class="command-palette-content">
                <div class="command-input-container">
                    <i class="ph ph-magnifying-glass"></i>
                    <input type="text" id="command-input" placeholder="What would you like to do? (e.g. 'Export', 'Dark Mode'...)" autocomplete="off">
                </div>
                <div id="command-results" class="command-results">
                    <!-- Results populated by JS -->
                </div>
            </div>
            <div class="modal-backdrop"></div>
        </div>

        <!-- Find & Replace Bar -->
        <div id="find-box" class="find-replace-bar hidden">
            <div class="find-inputs">
                <input type="text" id="find-input" placeholder="Search...">
                <input type="text" id="replace-input" placeholder="Replace with...">
            </div>
            <div class="find-actions">
                <button id="find-prev" class="btn secondary small" title="Previous"><i class="ph ph-caret-up"></i></button>
                <button id="find-next" class="btn secondary small" title="Next"><i class="ph ph-caret-down"></i></button>
                <button id="replace-btn" class="btn secondary" title="Replace">Replace</button>
                <button id="replace-all-btn" class="btn secondary" title="Replace All">All</button>
                <button id="close-find" class="btn secondary icon-only small"><i class="ph ph-x"></i></button>
            </div>
        </div>

        <script src="script.js?v=10"></script>
    </body>
</html>
